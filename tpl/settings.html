{include="header"}
<div class="settings">
    {if="!empty($login)"}
        {if="$configured == 0"}<p>Choisissez le mot de passe à utiliser pour protéger les préférences.</p>{/if}
        <form method="post" action="?settings=">
            <p><label for="password">Mot de passe {if="$configured == 0"}(apparaîtra en clair){/if}: </label><input {if="$configured == 1"}type="password"{else}type="text"{/if} name="password" id="password"/></p>
            <p><input type="submit" value="{if="$configured == 1"}Connexion{else}Enregistrer{/if}"/></p>
        </form>
    {else}
        {if="$settings === false"}
            <p><a href="?settings=logout">Déconnexion</a></p>
            <h2>Liste des capteurs actuellement autorisés</h2>
            <p><a href="?settings=add_device">Ajouter un capteur</a></p>
            <table>
                <tr>
                    <th>Nom</th>
                    <th>Clé</th>
                    <th>Modifier</th>
                    <th>Supprimer</th>
                </tr>
                {loop="$capteurs"}
                    <tr>
                        <td>{function="htmlspecialchars($value)"}</td>
                        <td>{function="htmlspecialchars($key)"}</td>
                        <td><a href="?settings=edit_device&amp;key={function="htmlspecialchars($key)"}">Modifier</a></td>
                        <td><a href="?settings=delete_device&amp;key={function="htmlspecialchars($key)"}">Supprimer</a></td>
                    </tr>
                {/loop}
            </table>

            <h2>Liste des types de mesure disponibles</h2>
            <p><a href="?settings=add_type">Ajouter un type</a></p>
            <table>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Unité</th>
                    <th>Seuil 1</th>
                    <th>Seuil 2</th>
                    <th>Seuil 3</th>
                    <th>Validité spatiale</th>
                    <th>Opacité réduite après</th>
                    <th>Opacité min. après</th>
                    <th>Modifier</th>
                    <th>Supprimer</th>
                </tr>
                {loop="$types"}
                    <tr>
                        <td>{function="htmlspecialchars($key)"}</td>
                        <td>{$value['name']}</td>
                        <td>{$value['unit']}</td>
                        <td>{function="htmlspecialchars($value['seuil_1'])"}</td>
                        <td>{function="htmlspecialchars($value['seuil_2'])"}</td>
                        <td>{function="htmlspecialchars($value['seuil_3'])"}</td>
                        <td>{function="htmlspecialchars($value['spatial_validity'])"}</td>
                        <td>{function="htmlspecialchars($value['start_decrease'])"}</td>
                        <td>{function="htmlspecialchars($value['fully_gone'])"}</td>
                        <td><a href="?settings=edit_type&amp;id={function="htmlspecialchars($key)"}">Modifier</a></td>
                        <td><a href="?settings=delete_type&amp;id={function="htmlspecialchars($key)"}">Supprimer</a></td>
                    </tr>
                {/loop}
            </table>
        {elseif="$settings == 'add_device' || ($settings == 'edit_device' && !empty($device_key))"}
            <form method="post" action="?settings=">
                <p><label for="device">Nom : </label><input type="text" name="device" id="device" {if="!empty($device_key)"}value="{function="htmlspecialchars($api_keys[$device_key])"}"{/if}/></p>
                <p>
                    <input type="submit" value="Sauver"/> ou <a href="?settings=">Retour</a>
                    {if="!empty($device_key)"}<input type="hidden" name="key" value="{function="htmlspecialchars($device_key)"}"/>{/if}
                </p>
            </form>
        {elseif="$settings == 'add_type' || ($settings == 'edit_type' && !empty($type_id))"}
            <form method="post" action="?settings=">
                <p><label for="id">ID : </label><input types="text" name="id" id="id" {if="!empty($type_id)"}value="{function="htmlspecialchars($type_id)"}"{/if}/></p>
                <p><label for="name">Nom (HTML possible) : </label><input types="text" name="name" id="name" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['name'])"}"{/if}/></p>
                <p><label for="unit">Unité (HTML possible) : </label><input types="text" name="unit" id="unit" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['unit'])"}"{/if}/></p>
                <p><label for="seuil_1">Seuil 1 : </label><input types="number" name="seuil_1" id="seuil_1" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['seuil_1'])"}"{/if}/></p>
                <p><label for="seuil_2">Seuil 2 : </label><input types="number" name="seuil_2" id="seuil_2" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['seuil_2'])"}"{/if}/></p>
                <p><label for="seuil_3">Seuil 3 : </label><input types="number" name="seuil_3" id="seuil_3" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['seuil_3'])"}"{/if}/></p>
                <p><label for="spatial_validity">Validité spatiale (diamètre, en mètres) : </label><input types="number" name="spatial_validity" id="spatial_validity" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['spatial_validity'])"}"{/if}/></p>
                <p><label for="start_decrease">Durée avant baisse de l'opacité (en secondes) : </label><input types="number" name="start_decrease" id="start_decrease" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['start_decrease'])"}"{/if}/></p>
                <p><label for="fully_gone">Durée avant opacité min. (en secondes) : </label><input types="number" name="fully_gone" id="fully_gone" {if="!empty($type_id)"}value="{function="htmlspecialchars($types[$type_id]['fully_gone'])"}"{/if}/></p>
                <p>
                    <input type="submit" value="Sauver"/> ou <a href="?settings=">Retour</a>
                </p>
            </form>
        {/if}
    {/if}
</div>
